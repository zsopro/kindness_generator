<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>NEO ADMIN - JSON AUTO-COPY VERSION</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron&family=Dancing+Script&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0a0a0a; color: white; display: flex; height: 100vh; margin: 0; overflow: hidden; }
        .settings-panel { width: 420px; background: #181818; padding: 15px; overflow-y: auto; border-right: 2px solid #333; }
        .preview-panel { flex: 1; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: space-evenly; overflow: hidden; }
        .templates-panel { width: 300px; background: #181818; padding: 15px; border-left: 2px solid #333; overflow-y: auto; }
        .preview-box { transform-origin: center; zoom: 0.6; }
        .phone-p { width: 360px; height: 640px; border: 10px solid #222; border-radius: 40px; background: #000; overflow: hidden; }
        .phone-l { width: 640px; height: 360px; border: 10px solid #222; border-radius: 40px; background: #000; overflow: hidden; }
        .section { background: #222; padding: 10px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #0f0; position: relative; }
        h4 { margin: 0 0 5px 0; font-size: 0.7rem; color: #0f0; text-transform: uppercase; }
        label { font-size: 0.55rem; color: #aaa; text-transform: uppercase; display: block; margin-top: 5px; }
        input, select { width: 100%; padding: 5px; background: #333; color: #fff; border: 1px solid #444; border-radius: 4px; font-size: 0.75rem; }
        .row { display: flex; gap: 5px; } .row > div { flex: 1; }
        .live-toggle { background: #444; color: #fff; padding: 10px; text-align: center; font-weight: bold; cursor: pointer; border-radius: 5px; margin-bottom: 10px; transition: 0.3s; }
        .live-toggle.on { background: #0f0; color: #000; }
        .btn-add { background: #0df; color: #000; border: none; padding: 10px; font-weight: bold; width: 100%; cursor: pointer; border-radius: 5px; margin: 10px 0; }
        .btn-del { position: absolute; top: 5px; right: 5px; background: #f00; border: none; color: #fff; font-size: 10px; border-radius: 3px; cursor: pointer; }
        #save-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #222; padding: 20px; border: 2px solid #0f0; z-index: 1000; display: none; width: 320px; box-shadow: 0 0 50px #000; }
        .template-item { background: #333; padding: 8px; margin-bottom: 5px; cursor: pointer; font-size: 0.8rem; border-radius: 4px; border-left: 3px solid #0f0; }
    </style>
</head>
<body>

    <div id="save-modal">
        <h4>üíæ Ment√©s Sablonk√©nt</h4>
        <label>Kateg√≥ria:</label><select id="modal-cat-list"></select>
        <label style="margin-top:10px;">N√©v:</label><input type="text" id="modal-new-name" placeholder="Sablon neve...">
        <button onclick="confirmSave()" style="background:#0f0; color:#000; padding:10px; width:100%; margin-top:15px; cursor:pointer; font-weight:bold;">MENT√âS & M√ÅSOL√ÅS</button>
        <button onclick="document.getElementById('save-modal').style.display='none'" style="background:#444; color:#fff; padding:10px; width:100%; margin-top:5px; cursor:pointer;">M√âGSE</button>
    </div>

    <div class="settings-panel">
        <div id="edit-toggle" class="live-toggle" onclick="toggleEdit()">SZERKESZT≈ê M√ìD: KI</div>
        <div class="section">
            <h4>Vide√≥ & Alap</h4>
            <div class="row">
                <div><label>Gomb</label><input type="text" id="btn" oninput="update()"></div>
                <div><label>YT ID</label><input type="text" id="yt" oninput="update()"></div>
            </div>
            <div class="row">
                <div><label>VX%</label><input type="number" id="vx" oninput="update()"></div>
                <div><label>VY%</label><input type="number" id="vy" oninput="update()"></div>
                <div><label>VW%</label><input type="number" id="vw" oninput="update()"></div>
                <div><label>VH%</label><input type="number" id="vh" oninput="update()"></div>
            </div>
            <label>Mute: <input type="checkbox" id="mute" onchange="update()"></label>
        </div>
        <div class="section">
            <h4>F≈ëc√≠m</h4>
            <input type="text" id="cim" oninput="update()">
            <div class="row">
                <div><label>Bet≈±</label><select id="mf" onchange="update()"></select></div>
                <div><label>S%</label><input type="number" id="ms" oninput="update()"></div>
                <div><label>Sz√≠n</label><input type="color" id="mc" value="#00ff00" oninput="update()"></div>
            </div>
            <div class="row"><div><label>X%</label><input type="number" id="mx" oninput="update()"></div><div><label>Y%</label><input type="number" id="my" oninput="update()"></div></div>
        </div>
        <div class="section">
            <h4>Alc√≠m</h4>
            <input type="text" id="alcim" oninput="update()">
            <div class="row">
                <div><label>Bet≈±</label><select id="sf" onchange="update()"></select></div>
                <div><label>S%</label><input type="number" id="ss" oninput="update()"></div>
                <div><label>Sz√≠n</label><input type="color" id="sc" value="#00ff00" oninput="update()"></div>
            </div>
            <div class="row"><div><label>X%</label><input type="number" id="sx" oninput="update()"></div><div><label>Y%</label><input type="number" id="sy" oninput="update()"></div></div>
        </div>
        <div id="dynamic-texts"></div>
        <button class="btn-add" onclick="addTextField()">[+] √öJ SZ√ñVEGMEZ≈ê</button>
        <div class="section">
            <h4>Effekt</h4>
            <select id="eff" onchange="update()"><option value="none">Nincs</option><option value="heart">Sz√≠v</option><option value="snow">H√≥</option><option value="flower">Vir√°g</option><option value="bday">üéâ</option></select>
            <div class="row"><div><label>Intenz.</label><input type="number" id="intens" oninput="update()"></div><div><label>Sz√≠n</label><input type="color" id="ec" value="#ffffff" oninput="update()"></div></div>
            <label>Egyedi URL</label><input type="text" id="eff_url" oninput="update()">
        </div>
        <div class="section">
            <h4>K√©p 1</h4>
            <input type="text" id="d1url" oninput="update()">
            <div class="row">
                <div><label>X</label><input type="number" id="d1x" oninput="update()"></div>
                <div><label>Y</label><input type="number" id="d1y" oninput="update()"></div>
                <div><label>W</label><input type="number" id="d1w" oninput="update()"></div>
                <div><label>H</label><input type="number" id="d1h" oninput="update()"></div>
            </div>
        </div>
    </div>

    <div class="preview-panel">
        <div class="preview-box phone-p"><iframe id="ifr_p" src="about:blank" width="100%" height="100%" frameborder="0"></iframe></div>
        <div class="preview-box phone-l"><iframe id="ifr_l" src="about:blank" width="100%" height="100%" frameborder="0"></iframe></div>
    </div>

    <div class="templates-panel">
        <h4>üìÅ Sablonok</h4>
        <select id="main-cat" onchange="updateSubCats()"></select>
        <select id="sub-cat" onchange="renderTemplates()" style="margin-top:5px;"></select>
        <div id="template-list" style="margin-top:10px;"></div>
        <button onclick="copyLink()" style="background:#0f0; width:100%; border:none; padding:10px; font-weight:bold; margin-top:10px;">LINK M√ÅSOL√ÅSA</button>
        <button onclick="openSaveModal()" style="background:#007bff; color:#fff; width:100%; border:none; padding:10px; margin-top:5px; cursor:pointer;">MENT√âS</button>
    </div>

<script>
    let editMode = false, textCount = 0;
    const fonts = ["Orbitron", "Dancing Script", "Pacifico", "Bebas Neue", "Great Vibes", "Monoton", "Press Start 2P", "Rajdhani", "Satisfy", "Comfortaa", "Righteous", "Cinzel", "Lobster", "Kaushan Script", "Permanent Marker", "Exo 2", "Abril Fatface", "Unbounded", "Special Elite", "Russo One"];
    let catData = {}, templates = [];

    function resetAllFields() {
        document.querySelectorAll('.settings-panel input').forEach(i => {
            if(i.type === 'checkbox') i.checked = false;
            else if(i.type === 'color') i.value = (i.id === 'ec' ? '#ffffff' : '#00ff00');
            else i.value = '';
        });
        document.querySelectorAll('.settings-panel select').forEach(s => s.selectedIndex = 0);
        document.getElementById('dynamic-texts').innerHTML = '';
        textCount = 0;
        document.getElementById('ifr_p').src = 'about:blank';
        document.getElementById('ifr_l').src = 'about:blank';
    }

    function addTextField(data = null) {
        textCount++;
        const id = textCount;
        const div = document.createElement('div');
        div.className = 'section text-block'; div.id = `tg-${id}`;
        div.innerHTML = `<button class="btn-del" onclick="this.parentElement.remove();update()">X</button>
            <h4>EXTRA MEZ≈ê #${id}</h4><input type="text" id="txt${id}" oninput="update()">
            <div class="row"><div><label>F</label><select id="f${id}" onchange="update()"></select></div><div><label>S%</label><input type="number" id="s${id}" oninput="update()"></div><div><label>C</label><input type="color" id="c${id}" value="#ffffff" oninput="update()"></div></div>
            <div class="row"><div><label>X%</label><input type="number" id="x${id}" oninput="update()"></div><div><label>Y%</label><input type="number" id="y${id}" oninput="update()"></div></div>`;
        document.getElementById('dynamic-texts').appendChild(div);
        fonts.forEach(f => document.getElementById(`f${id}`).add(new Option(f, f)));
        if(data) {
            document.getElementById(`txt${id}`).value = data.txt || '';
            document.getElementById(`f${id}`).value = data.f || 'Orbitron';
            document.getElementById(`c${id}`).value = '#' + (data.c || 'ffffff');
            document.getElementById(`s${id}`).value = data.s || '';
            document.getElementById(`x${id}`).value = data.x || '';
            document.getElementById(`y${id}`).value = data.y || '';
        }
    }

    async function init() {
        ['mf','sf'].forEach(id => fonts.forEach(f => document.getElementById(id).add(new Option(f, f))));
        resetAllFields(); 
        try {
            const cRes = await fetch('categories.json');
            catData = (await cRes.json()).categories;
            const mc = document.getElementById('main-cat');
            const mlc = document.getElementById('modal-cat-list');
            Object.keys(catData).forEach(k => {
                mc.add(new Option(k, k));
                catData[k].forEach(sub => mlc.add(new Option(`${k} > ${sub}`, sub)));
            });
            updateSubCats();
            const tRes = await fetch('templates.json');
            const tData = await tRes.json();
            templates = tData.templates;
            renderTemplates();
        } catch(e) { console.error("Adat bet√∂lt√©si hiba", e); }
    }

    function loadT(pStr) {
        resetAllFields(); 
        const p = new URLSearchParams(pStr);
        const basics = ['btn','yt','vx','vy','vw','vh','mute','cim','mf','ms','mc','mx','my','alcim','sf','ss','sc','sx','sy','eff','intens','ec','eff_url','d1url','d1x','d1y','d1w','d1h'];
        basics.forEach(id => {
            const tid = id === 'eff' ? 'effect' : id;
            const el = document.getElementById(id);
            if(el && p.has(tid)) {
                if(el.type === 'checkbox') el.checked = p.get(tid) === '1';
                else el.value = (el.type === 'color' ? '#' : '') + p.get(tid);
            }
        });
        let i = 1;
        while(p.has('txt'+i)) {
            addTextField({txt:p.get('txt'+i), f:p.get('f'+i), c:p.get('c'+i), s:p.get('s'+i), x:p.get('x'+i), y:p.get('y'+i)});
            i++;
        }
        update();
    }

    function update() {
        const p = new URLSearchParams();
        const basics = ['btn','yt','vx','vy','vw','vh','mute','cim','mf','ms','mc','mx','my','alcim','sf','ss','sc','sx','sy','eff','intens','ec','eff_url','d1url','d1x','d1y','d1w','d1h'];
        basics.forEach(id => {
            const el = document.getElementById(id);
            if(el) {
                const val = el.type==='checkbox' ? (el.checked?'1':'0') : el.value.replace('#','');
                if(val && val !== '0' && val !== '') p.set(id==='eff'?'effect':id, val);
            }
        });
        document.querySelectorAll('.text-block').forEach((block, idx) => {
            const oldId = block.id.split('-')[1];
            const newId = idx + 1;
            const val = document.getElementById(`txt${oldId}`).value;
            if(val) {
                p.set(`txt${newId}`, val);
                p.set(`f${newId}`, document.getElementById(`f${oldId}`).value);
                p.set(`c${newId}`, document.getElementById(`c${oldId}`).value.replace('#',''));
                p.set(`s${newId}`, document.getElementById(`s${oldId}`).value);
                p.set(`x${newId}`, document.getElementById(`x${oldId}`).value);
                p.set(`y${newId}`, document.getElementById(`y${oldId}`).value);
            }
        });
        if(editMode) p.set('edit', '1');
        const url = 'index.html?' + p.toString();
        document.getElementById('ifr_p').src = url;
        document.getElementById('ifr_l').src = url;
    }

    function toggleEdit() { 
        editMode = !editMode; 
        const btn = document.getElementById('edit-toggle');
        btn.innerText = "SZERKESZT≈ê M√ìD: " + (editMode ? "BE" : "KI");
        if(editMode) btn.classList.add('on'); else btn.classList.remove('on');
        update(); 
    }
    
    function updateSubCats() {
        const sub = document.getElementById('sub-cat'); sub.innerHTML = "";
        const main = document.getElementById('main-cat').value;
        if(catData[main]) catData[main].forEach(s => sub.add(new Option(s, s)));
        renderTemplates();
    }
    function renderTemplates() {
        const sub = document.getElementById('sub-cat').value;
        const list = document.getElementById('template-list'); list.innerHTML = "";
        templates.filter(t => t.subCategory === sub).forEach(t => {
            const d = document.createElement('div'); d.className = 'template-item';
            d.onclick = () => loadT(t.params); d.innerText = t.name;
            list.appendChild(d);
        });
    }
    function openSaveModal() { document.getElementById('save-modal').style.display = 'block'; }

        function confirmSave() {
        const mainCat = document.getElementById('main-cat').value; // F≈ë kateg√≥ria
        const subCat = document.getElementById('sub-cat').value;   // Alkateg√≥ria
        const name = document.getElementById('modal-new-name').value;
        
        if(!name) { alert("Adj meg egy nevet!"); return; }
        
        const currentSrc = document.getElementById('ifr_p').src;
        if(!currentSrc.includes('?')) { alert("Nincs mit menteni!"); return; }
        
        const p = new URLSearchParams(currentSrc.split('?')[1]);
        p.delete('edit');
        
        // √öJ: Most m√°r mentj√ºk a f≈ë kateg√≥ri√°t is (category), √≠gy pontos lesz az azonos√≠t√°s
        const newTemplate = { 
            name: name, 
            category: mainCat, 
            subCategory: subCat, 
            params: p.toString() 
        };
        
        templates.push(newTemplate);
        
        const fullJson = JSON.stringify({ templates: templates }, null, 2);
        
        console.log("--- √öJ TEMPLATES.JSON ---", fullJson);
        
        navigator.clipboard.writeText(fullJson).then(() => {
            alert("Sikeres ment√©s! A teljes JSON a v√°g√≥lapon.");
        });
        
        document.getElementById('save-modal').style.display = 'none';
        renderTemplates();
            }
    

    function copyLink() {
        const p = new URLSearchParams(document.getElementById('ifr_p').src.split('?')[1]);
        p.delete('edit');
        navigator.clipboard.writeText(window.location.href.replace('admin.html', 'index.html?' + p.toString()));
        alert("Link m√°solva!");
    }
    window.onload = init;
</script>
</body>
</html>
