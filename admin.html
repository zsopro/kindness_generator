<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>NEO Admin - Dinamikus K√©pek</title>
    <style>
        :root { --neon: #0f0; --bg: #111; }
        body { margin: 0; display: flex; height: 100vh; background: #000; color: #fff; font-family: sans-serif; overflow: hidden; }
        .sidebar { width: 450px; background: #1a1a1a; border-right: 2px solid #333; overflow-y: auto; display: flex; flex-direction: column; }
        .preview-area { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: space-around; background: #080808; }
        
        /* Accordion */
        .accordion-item { border-bottom: 1px solid #333; }
        .accordion-header { padding: 15px; background: #222; cursor: pointer; display: flex; justify-content: space-between; font-weight: bold; font-size: 0.8rem; }
        .accordion-content { padding: 15px; display: none; background: #151515; }
        .accordion-content.active { display: block; }

        /* Controls */
        .live-toggle { background: #444; color: #fff; padding: 12px; text-align: center; font-weight: bold; cursor: pointer; margin: 10px; border-radius: 5px; }
        .live-toggle.on { background: var(--neon); color: #000; }
        .control-bar { padding: 10px; display: flex; gap: 5px; background: #222; }
        .btn { flex: 1; padding: 10px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; text-transform: uppercase; font-size: 0.7rem; }
        .btn-refresh { background: #007bff; color: white; }
        .btn-pause { background: #ffc107; color: #000; }
        
        /* Dinamikus gombok */
        .btn-add { background: #28a745; color: white; margin-top: 10px; }
        .btn-rem { background: #dc3545; color: white; margin-top: 10px; }

        /* Transform Grid */
        .view-grid { display: flex; gap: 5px; margin-top: 10px; border: 1px dashed #444; padding: 5px; }
        .view-section { flex: 1; }
        .view-section h6 { margin: 0 0 5px; font-size: 0.6rem; color: #888; }
        .input-group { display: grid; grid-template-columns: 1fr 1fr; gap: 3px; }
        input { background: #333; border: 1px solid #444; color: #fff; padding: 5px; font-size: 0.7rem; width: 100%; box-sizing: border-box; }

        /* Preview Iframes */
        .preview-container { border: 5px solid #333; border-radius: 10px; overflow: hidden; background: #000; }
        .p-port { width: 240px; height: 426px; }
        .p-land { width: 426px; height: 240px; }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>

<div class="sidebar">
    <div id="edit-toggle" class="live-toggle" onclick="toggleEdit()">SZERKESZT≈ê M√ìD: KI</div>

    <div class="control-bar">
        <button class="btn btn-refresh" onclick="manualRefresh()">üîÑ Friss√≠t√©s</button>
        <button id="play-pause-btn" class="btn btn-pause" onclick="togglePlayback()">‚è∏ Sz√ºnet</button>
    </div>

    <div class="accordion-item">
        <div class="accordion-header" onclick="toggleAccordion(this)"><span>M√©dia (YouTube)</span><span class="sign">+</span></div>
        <div class="accordion-content">
            <input type="text" id="yt_input" placeholder="YouTube URL..." style="margin-bottom:10px;">
            <input type="hidden" id="yt">
            <div id="yt-fields"></div>
        </div>
    </div>

    <div class="accordion-item">
        <div class="accordion-header" onclick="toggleAccordion(this)"><span>K√©pek / Dekor√°ci√≥k</span><span class="sign">+</span></div>
        <div class="accordion-content">
            <div id="image-list"></div>
            <div style="display: flex; gap: 5px;">
                <button class="btn btn-add" onclick="ImageManager.add()">+ √öj k√©p</button>
                <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)"><span>K√©pek / Dekor√°ci√≥k</span><span class="sign">+</span></div>
                <div class="accordion-content">
                    <div id="image-list"></div>
                    <button class="btn btn-add" style="width:100%" onclick="ImageManager.add()">+ √öJ K√âP HOZZ√ÅAD√ÅSA</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="preview-area">
    <div class="preview-container p-port"><iframe id="ifr_p" src="index.html"></iframe></div>
    <div class="preview-container p-land"><iframe id="ifr_l" src="index.html"></iframe></div>
</div>

<script type="module">
    import { URLHandler } from './url-handler.js';
    import { TransformModule } from './transform-module.js';

    let isPlaying = true;
    let editMode = false;
    let imageCount = 0;

    // Glob√°lis ImageManager objektum
        window.ImageManager = {
        add: () => {
            imageCount++;
            const id = `d${imageCount}`;
            const div = document.createElement('div');
            div.id = `${id}-group`;
            div.style.padding = "15px 10px";
            div.style.borderBottom = "1px solid #444";
            div.style.position = "relative";
            div.style.background = "#1d1d1d";
            div.style.marginBottom = "5px";
    
            div.innerHTML = `
                <button onclick="ImageManager.removeByID('${id}-group')" 
                        style="position:absolute; right:5px; top:5px; background:#ff4444; color:white; border:none; border-radius:3px; cursor:pointer; font-size:0.6rem; padding:2px 6px;">X</button>
                <label style="font-size:0.6rem; color:var(--neon)">K√âP ID: ${id}</label>
                <input type="text" id="${id}url" placeholder="K√©p URL (https://...)" oninput="update()">
                ${TransformModule.createUIFields(id)}
            `;
            document.getElementById('image-list').appendChild(div);
    
            // ALAP√âRTELMEZETT √âRT√âKEK BE√ÅLL√çT√ÅSA (50%)
            // √Åll√≥ n√©zet
            document.getElementById(`${id}x`).value = 50;
            document.getElementById(`${id}y`).value = 50;
            document.getElementById(`${id}w`).value = 50;
            document.getElementById(`${id}h`).value = 50;
            // Fekv≈ë n√©zet
            document.getElementById(`l${id}x`).value = 50;
            document.getElementById(`l${id}y`).value = 50;
            document.getElementById(`l${id}w`).value = 50;
            document.getElementById(`l${id}h`).value = 50;
    
            window.update(); // Friss√≠t√©s, hogy az el≈ën√©zet is l√°ssa az alap√©rt√©keket
        },
        removeByID: (groupID) => {
            const el = document.getElementById(groupID);
            if (el) { el.remove(); window.update(); }
        }
    };

    window.toggleAccordion = (h) => {
        const c = h.nextElementSibling;
        c.classList.toggle('active');
        h.querySelector('.sign').innerText = c.classList.contains('active') ? '-' : '+';
    };

    window.toggleEdit = () => {
        editMode = !editMode;
        const btn = document.getElementById('edit-toggle');
        btn.innerText = "SZERKESZT≈ê M√ìD: " + (editMode ? "BE" : "KI");
        btn.classList.toggle('on', editMode);
        window.update();
    };

    window.update = () => {
        const params = { imgCount: imageCount };
        document.querySelectorAll('input').forEach(i => { 
            if(i.id && i.id !== 'yt_input') params[i.id] = i.value; 
        });
        if (editMode) params.edit = '1';

        [document.getElementById('ifr_p'), document.getElementById('ifr_l')].forEach(ifr => {
            if (ifr.contentWindow) {
                ifr.contentWindow.postMessage({ type: 'STYLE', params }, '*');
            }
        });
    };

    window.manualRefresh = () => {
        const p = new URLSearchParams();
        p.set('imgCount', imageCount);
        document.querySelectorAll('input').forEach(i => { 
            if(i.id && i.id !== 'yt_input' && i.value) p.set(i.id, i.value); 
        });
        if (editMode) p.set('edit', '1');
        
        const url = 'index.html?' + p.toString();
        document.getElementById('ifr_p').src = url;
        document.getElementById('ifr_l').src = url;
    };

    window.togglePlayback = () => {
        isPlaying = !isPlaying;
        document.getElementById('play-pause-btn').innerText = isPlaying ? "‚è∏ Sz√ºnet" : "‚ñ∂ Lej√°tsz√°s";
        [document.getElementById('ifr_p'), document.getElementById('ifr_l')].forEach(ifr => {
            ifr.contentWindow.postMessage({ type: 'VIDEO', action: isPlaying ? 'play' : 'pause' }, '*');
        });
    };

    // Kezd≈ë mez≈ëk
    window.addEventListener('DOMContentLoaded', () => {
        document.getElementById('yt-fields').innerHTML = TransformModule.createUIFields('v');
        document.getElementById('yt_input').addEventListener('input', (e) => {
            document.getElementById('yt').value = URLHandler.parseYouTubeID(e.target.value);
        });
    });
</script>
</body>
</html>
