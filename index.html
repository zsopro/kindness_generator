<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; }
        .element { position: absolute; transform: translate(-50%, -50%); pointer-events: none; }
        .edit-visual { outline: 2px dashed #0f0; }
    </style>
</head>
<body>
    <div id="v-cont" class="element"><div id="player"></div></div>
    <div id="d1-cont" class="element"><img id="d1-img" style="width:100%; height:100%; display:none;"></div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player;
        const urlP = new URLSearchParams(window.location.search);

        function onYouTubeIframeAPIReady() {
            const id = urlP.get('yt');
            if(!id) return;
            player = new YT.Player('player', {
                height: '100%', width: '100%', videoId: id,
                playerVars: { 'autoplay': 1, 'controls': 0, 'mute': 0, 'loop': 1, 'playlist': id },
                events: { 'onReady': () => apply(Object.fromEntries(urlP)) }
            });
        }

        // index.html apply függvény részlet
        function apply(p) {
            const isL = window.innerWidth > window.innerHeight;
            const pr = isL ? 'l' : '';
            
            // 1. Videó pozicionálása
            updateElementStyle('v-cont', 'v', p, pr);
        
            // 2. Minden olyan kulcs keresése, ami "url"-re végződik (pl. d1url, d2url)
            Object.keys(p).forEach(key => {
                if (key.endsWith('url')) {
                    const idBase = key.replace('url', ''); // pl. "d1"
                    let cont = document.getElementById(`${idBase}-cont`);
                    
                    // Ha még nincs konténer az előnézetben, létrehozzuk
                    if (!cont) {
                        cont = document.createElement('div');
                        cont.id = `${idBase}-cont`;
                        cont.className = 'element'; // Az alap stílusunk (absolute, translate stb.)
                        cont.innerHTML = `<img id="${idBase}-img" style="width:100%; height:100%; object-fit: contain; display: block;">`;
                        document.body.appendChild(cont);
                    }
                    
                    // Pozíció és méret frissítése
                    updateElementStyle(`${idBase}-cont`, idBase, p, pr);
                    
                    // Kép forrásának frissítése
                    const img = document.getElementById(`${idBase}-img`);
                    if (img.src !== p[key]) {
                        img.src = p[key];
                    }
                }
            });
        
            // 3. Törölt képek eltávolítása az előnézetből
            document.querySelectorAll('[id$="-cont"]').forEach(el => {
                const idBase = el.id.replace('-cont', '');
                // Ha nem a videóról van szó, és már nincs ilyen URL az adatokban, töröljük a DOM-ból
                if (idBase !== 'v' && !p[idBase + 'url']) {
                    el.remove();
                }
            });
        }
        
        function updateElementStyle(id, k, p, pr) {
            const el = document.getElementById(id);
            if(!el) return;
            el.style.left = (p[pr+k+'x'] || p[k+'x'] || 50) + '%';
            el.style.top = (p[pr+k+'y'] || p[k+'y'] || 50) + '%';
            el.style.width = (p[pr+k+'w'] || p[k+'w'] || 100) + 'vw';
            el.style.height = (p[pr+k+'h'] || p[k+'h'] || 100) + 'vh';
        }

        /*window.addEventListener('message', e => {
            if(e.data.type === 'STYLE') apply(e.data.params);
            if(e.data.type === 'EDIT_MODE') {
                document.body.classList.toggle('edit-visual', e.data.value);
            }
            if(e.data.type === 'VIDEO' && player) {
                e.data.action === 'pause' ? player.pauseVideo() : player.playVideo();
            }
        });*/
    </script>
</body>
</html>
