<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; }
        .element { position: absolute; transform: translate(-50%, -50%); pointer-events: none; }
        .edit-visual { outline: 2px dashed #0f0; }
    </style>
</head>
<body>
    <div id="v-cont" class="element"><div id="player"></div></div>
    <div id="d1-cont" class="element"><img id="d1-img" style="width:100%; height:100%; display:none;"></div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player;
        const urlP = new URLSearchParams(window.location.search);

        function onYouTubeIframeAPIReady() {
            const id = urlP.get('yt');
            if(!id) return;
            player = new YT.Player('player', {
                height: '100%', width: '100%', videoId: id,
                playerVars: { 'autoplay': 1, 'controls': 0, 'mute': 0, 'loop': 1, 'playlist': id },
                events: { 'onReady': () => apply(Object.fromEntries(urlP)) }
            });
        }

        function apply(p) {
            const isL = window.innerWidth > window.innerHeight;
            const pr = isL ? 'l' : '';
            
            // 1. Videó frissítése
            updateElementStyle('v-cont', 'v', p, pr);
        
            // 2. Dinamikus képek kezelése
            const count = parseInt(p.imgCount) || 0;
            for (let i = 1; i <= count; i++) {
                const id = `d${i}`;
                let cont = document.getElementById(`${id}-cont`);
                
                // Ha még nincs ilyen konténer, létrehozzuk
                if (!cont) {
                    cont = document.createElement('div');
                    cont.id = `${id}-cont`;
                    cont.className = 'element';
                    cont.innerHTML = `<img id="${id}-img" style="width:100%; height:100%; display:none; object-fit: contain;">`;
                    document.body.appendChild(cont);
                }
        
                // Pozíció és tartalom frissítése
                updateElementStyle(`${id}-cont`, id, p, pr);
                const img = document.getElementById(`${id}-img`);
                if (p[`${id}url`]) {
                    img.src = p[`${id}url`];
                    img.style.display = 'block';
                } else {
                    img.style.display = 'none';
                }
            }
        
            // Opcionális: a törölt képek eltávolítása a DOM-ból
            const allExisting = document.querySelectorAll('[id$="-cont"]');
            allExisting.forEach(el => {
                const num = parseInt(el.id.replace(/\D/g, ''));
                if (num > count && el.id !== 'v-cont') el.remove();
            });
        }
        
        function updateElementStyle(id, k, p, pr) {
            const el = document.getElementById(id);
            if(!el) return;
            el.style.left = (p[pr+k+'x'] || p[k+'x'] || 50) + '%';
            el.style.top = (p[pr+k+'y'] || p[k+'y'] || 50) + '%';
            el.style.width = (p[pr+k+'w'] || p[k+'w'] || 100) + 'vw';
            el.style.height = (p[pr+k+'h'] || p[k+'h'] || 100) + 'vh';
        }

        /*window.addEventListener('message', e => {
            if(e.data.type === 'STYLE') apply(e.data.params);
            if(e.data.type === 'EDIT_MODE') {
                document.body.classList.toggle('edit-visual', e.data.value);
            }
            if(e.data.type === 'VIDEO' && player) {
                e.data.action === 'pause' ? player.pauseVideo() : player.playVideo();
            }
        });*/
    </script>
</body>
</html>
