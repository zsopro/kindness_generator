<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kindness Generator Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- ALAP ST√çLUSOK --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { height: 100%; width: 100%; overflow: hidden; background-color: #000; font-family: 'Orbitron', sans-serif; color: #00ff00; }
        
        /* 3D H√°tt√©r r√©teg - a mozg√°s miatt 130%-os */
        #bg-layer { position: fixed; top: -15%; left: -15%; width: 130%; height: 130%; background-size: cover; background-position: center; z-index: 1; will-change: transform; transition: transform 0.2s ease-out; }
        /* Effekt (h√≥, sz√≠v, vir√°g) v√°szon */
        #canvas-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; }
        /* S√∂t√©t√≠t≈ë r√©teg a sz√∂veg olvashat√≥s√°g√°√©rt */
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4); z-index: 3; }

        /* Tartalom wrapper */
        #content-wrapper { position: relative; z-index: 4; text-align: center; width: 90%; margin: auto; height: 100vh; display: none; flex-direction: column; align-items: center; justify-content: center; text-shadow: 0 0 15px rgba(0,255,0,0.7); }
        #main-title { font-size: 2.5rem; margin-bottom: 10px; text-transform: uppercase; }
        #sub-title { font-size: 1.2rem; opacity: 0.9; min-height: 1.5rem; }

        /* Ind√≠t√≥ gomb */
        #enter-btn { padding: 20px 40px; font-size: 1.2rem; background: rgba(0,255,0,0.1); border: 2px solid #00ff00; color: #00ff00; cursor: pointer; font-family: 'Orbitron', sans-serif; box-shadow: 0 0 20px rgba(0,255,0,0.5); z-index: 100; text-transform: uppercase; transition: 0.3s; }
        #enter-btn:hover { background: rgba(0,255,0,0.3); box-shadow: 0 0 30px #00ff00; }

        /* Multim√©dia elemek */
        #video-wrapper, #gallery-wrapper { display: none; margin-top: 20px; width: 100%; }
        iframe { width: 100%; max-width: 500px; height: 280px; border: 2px solid #00ff00; border-radius: 8px; }
        .slide { display: none; width: 100%; border: 2px solid #00ff00; border-radius: 10px; max-height: 50vh; object-fit: contain; }
        .gallery-container { position: relative; width: 100%; max-width: 400px; margin: auto; }
        
        /* Dekor√°ci√≥s elem */
        #decoration { position: fixed; bottom: 20px; right: 20px; z-index: 5; max-width: 180px; height: auto; pointer-events: none; filter: drop-shadow(0 0 15px rgba(255,255,255,0.5)); display: none; }
    </style>
</head>
<body>

    <div id="bg-layer"></div>
    <canvas id="canvas-overlay"></canvas>
    <div id="overlay"></div>

    <div id="content-wrapper">
        <button id="enter-btn" onclick="initializeSystem()">KATTINTS R√ÅM</button>
        <h1 id="main-title"></h1>
        <div id="sub-title"></div>
        <div id="video-wrapper"><div id="player"></div></div>
        <div id="gallery-wrapper">
            <div class="gallery-container" id="gallery"></div>
            <div id="bg-audio-player" style="display:none;"></div>
        </div>
    </div>

    <img id="decoration" src="" alt="Dekor√°ci√≥">

    <script>
        /* --- PARAM√âTEREK MAGYAR√ÅZATA --- */
        const urlParams = new URLSearchParams(window.location.search);
        
        // [preset]  -> El≈ëre be√°ll√≠tott √ºnnep (valentin, anyakhnapja, nonap, szulinap, karacsony, eskuvo, matrix)
        // [cim]     -> A nagy f≈ëc√≠m sz√∂vege
        // [alcim]   -> Az √≠r√≥g√©ppel megjelen≈ë alc√≠m
        // [gomb]    -> Az ind√≠t√≥gomb sz√∂vege
        // [bg]      -> H√°tt√©r: sz√≠nk√≥d (pl. FF0000) vagy egy teljes URL k√©phez
        // [effect]  -> Vizu√°lis effekt: snow (h√≥), heart (sz√≠v), flower (vir√°g), matrix (k√≥d), star (csillog√°s)
        // [bgmove]  -> 1 eset√©n mozog a h√°tt√©r eg√©rre/d√∂nt√©sre, 0 eset√©n fix
        // [zene]    -> YouTube vide√≥ azonos√≠t√≥ja (ID)
        // [mode]    -> Megjelen√≠t√©s: 'zene' (h√°tt√©rben), 'video' (l√°that√≥ lej√°tsz√≥), 'kep' (gal√©ria)
        
        const pPreset = urlParams.get('preset');
        const pCim    = urlParams.get('cim');
        const pAlcim  = urlParams.get('alcim');
        const pGomb   = urlParams.get('gomb') || "IND√çT√ÅS";
        let pBg       = urlParams.get('bg');
        let pEffect   = urlParams.get('effect');
        let pDeco     = urlParams.get('deco');
        const pBgMove = urlParams.get('bgmove') || "1";
        const pIntens = parseInt(urlParams.get('intensity')) || 6;
        const pSize   = parseInt(urlParams.get('psize')) || 0;
        const pZene   = urlParams.get('zene');
        const pMode   = urlParams.get('mode') || "zene";
        const pKepek  = urlParams.get('kepek') ? urlParams.get('kepek').split(',') : [];

        /* --- KIEMELT SABLONOK DEFINI√ÅL√ÅSA --- */
        const presets = {
            'valentin':   { bg: '660000', effect: 'heart',  color: '#ff4d4d' },
            'anyakhnapja':{ bg: '4a0e2e', effect: 'flower', color: '#ffb3d9' },
            'nonap':      { bg: '2e0854', effect: 'flower', color: '#e0b0ff' },
            'szulinap':   { bg: '001a33', effect: 'star',   color: '#ffd700' },
            'karacsony':  { bg: '052210', effect: 'snow',   color: '#ffffff' },
            'eskuvo':     { bg: '222222', effect: 'star',   color: '#e5e4e2' },
            'eljegyzes':  { bg: '222222', effect: 'star',   color: '#e5e4e2' },
            'matrix':     { bg: '000000', effect: 'matrix', color: '#00ff00' }
        };

        // Sablon √©rt√©kek alkalmaz√°sa, ha nincs egyedi megadva
        if (pPreset && presets[pPreset]) {
            const s = presets[pPreset];
            if (!pBg) pBg = s.bg;
            if (!pEffect) pEffect = s.effect;
            document.documentElement.style.setProperty('--theme-color', s.color);
            document.body.style.color = s.color;
            document.body.style.textShadow = `0 0 10px ${s.color}`;
        }

        /* --- EFFEKT MOTOR (Canvas) --- */
        const canvas = document.getElementById('canvas-overlay');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function initParticles() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            particles = [];
            let count = pIntens * 15;
            for (let i = 0; i < count; i++) {
                let char = '‚óè';
                if (pEffect === 'heart') char = '‚ù§';
                if (pEffect === 'flower') char = 'üå∏';
                if (pEffect === 'matrix') char = String.fromCharCode(0x30A0 + Math.random() * 96);
                if (pEffect === 'star') char = '‚ú®';

                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: (Math.random() * (pEffect === 'snow' ? 5 : 20) + 5) + pSize,
                    speed: Math.random() * 2 + 1,
                    opacity: Math.random(),
                    char: char
                });
            }
        }

        function drawParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => {
                ctx.globalAlpha = p.opacity;
                ctx.fillStyle = (pPreset && presets[pPreset]) ? presets[pPreset].color : '#00ff00';
                ctx.font = `${p.size}px Arial`;
                ctx.fillText(p.char, p.x, p.y);
                p.y += p.speed;
                if (p.y > canvas.height) { p.y = -20; p.x = Math.random() * canvas.width; }
            });
            requestAnimationFrame(drawParticles);
        }

        /* --- RENDSZER IND√çT√ÅSA --- */
        if (pCim || pAlcim || pPreset) {
            document.getElementById('content-wrapper').style.display = 'flex';
            document.getElementById('enter-btn').innerText = pGomb;
            const bgLayer = document.getElementById('bg-layer');
            if (pBg && pBg.startsWith('http')) bgLayer.style.backgroundImage = `url('${pBg}')`;
            else bgLayer.style.backgroundColor = `#${pBg || '000000'}`;

            if (pBgMove === "1") {
                window.addEventListener('mousemove', (e) => {
                    bgLayer.style.transform = `translate(${(window.innerWidth/2 - e.pageX)/15}px, ${(window.innerHeight/2 - e.pageY)/15}px)`;
                });
            }
            if (pEffect) { initParticles(); drawParticles(); }
            if (pDeco) { const d = document.getElementById('decoration'); d.src = pDeco; d.style.display = 'block'; }
            
            var tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            document.head.appendChild(tag);
        }

        var player;
        function onYouTubeIframeAPIReady() {
            if(!pZene) return;
            player = new YT.Player((pMode === 'video' ? 'player' : 'bg-audio-player'), {
                height: (pMode === 'video' ? '280' : '0'), width: '100%', videoId: pZene,
                playerVars: { 'autoplay': 0, 'controls': (pMode === 'video' ? 1 : 0), 'rel':0, 'mute':1 }
            });
        }

        async function initializeSystem() {
            if (pBgMove === "1" && typeof DeviceOrientationEvent !== 'undefined') {
                if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                    const resp = await DeviceOrientationEvent.requestPermission();
                    if (resp === 'granted') window.addEventListener('deviceorientation', (e) => {
                        document.getElementById('bg-layer').style.transform = `translate(${e.gamma * 2}px, ${(e.beta - 45) * 2}px)`;
                    });
                } else {
                    window.addEventListener('deviceorientation', (e) => {
                        document.getElementById('bg-layer').style.transform = `translate(${e.gamma * 2}px, ${(e.beta - 45) * 2}px)`;
                    });
                }
            }
            document.getElementById('enter-btn').style.display = 'none';
            typeWriter(pCim || "", "main-title", 60, () => { if(pAlcim) typeWriter(pAlcim, "sub-title", 40); });
            if (pMode === 'video') document.getElementById('video-wrapper').style.display = 'block';
            if (pMode === 'kep') { document.getElementById('gallery-wrapper').style.display = 'block'; setupGallery(); }
            if(player && player.playVideo) { player.unMute(); player.setVolume(100); player.playVideo(); }
        }

        function typeWriter(text, elementId, speed, callback) {
            let i = 0; const el = document.getElementById(elementId);
            function t() { if (i < text.length) { el.innerHTML += text.charAt(i); i++; setTimeout(t, speed); } else if (callback) callback(); }
            t();
        }

        function setupGallery() {
            const container = document.getElementById('gallery');
            pKepek.forEach((url) => {
                let img = document.createElement('img'); img.src = url; img.className = 'slide';
                container.appendChild(img);
            });
            if(pKepek.length) document.getElementsByClassName('slide')[0].style.display = 'block';
        }
    </script>
</body>
</html>
