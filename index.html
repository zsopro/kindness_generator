<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>kindness_generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { height: 100%; width: 100%; overflow: hidden; background-color: #000; font-family: 'Orbitron', sans-serif; color: #00ff00; }
        
        #bg-layer { position: fixed; top: -15%; left: -15%; width: 130%; height: 130%; background-size: cover; background-position: center; z-index: 1; will-change: transform; transition: transform 0.2s ease-out; }
        #canvas-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4); z-index: 3; }

        #content-wrapper { position: relative; z-index: 4; text-align: center; width: 90%; margin: auto; height: 100vh; display: none; flex-direction: column; align-items: center; justify-content: center; text-shadow: 0 0 10px #00ff00; }
        #main-title { font-size: 2.2rem; margin-bottom: 10px; text-transform: uppercase; }
        #sub-title { font-size: 1.1rem; opacity: 0.9; }
        #enter-btn { padding: 20px 40px; font-size: 1.2rem; background: rgba(0,255,0,0.1); border: 2px solid #00ff00; color: #00ff00; cursor: pointer; font-family: 'Orbitron', sans-serif; box-shadow: 0 0 20px rgba(0,255,0,0.5); z-index: 100; text-transform: uppercase; }
        #video-wrapper, #gallery-wrapper { display: none; margin-top: 20px; width: 100%; }
        iframe { width: 100%; max-width: 500px; height: 280px; border: 2px solid #00ff00; border-radius: 8px; }
        .slide { display: none; width: 100%; border: 2px solid #00ff00; border-radius: 10px; max-height: 50vh; object-fit: contain; }
        .gallery-container { position: relative; width: 100%; max-width: 400px; margin: auto; }
        .nav-btn { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,255,0,0.5); border: none; color: white; font-size: 1.5rem; cursor: pointer; padding: 10px; z-index: 11; }
        .prev { left: -50px; } .next { right: -50px; }

        /* DEKORÁCIÓ STÍLUSOK */
        #decoration {
            position: fixed; bottom: 20px; right: 20px; z-index: 5; /* A szöveg fölé kerül */
            max-width: 150px; /* Állítsd be a méretet igény szerint */
            height: auto;
            pointer-events: none; /* Ne akadályozza az érintést */
            filter: drop-shadow(0 0 10px rgba(0,255,0,0.5)); /* Kis neon ragyogás */
        }
        .decoration-rotate { /* Forgás animáció, ha kell */
            animation: rotate3D 10s infinite linear;
        }
        @keyframes rotate3D {
            from { transform: rotateY(0deg); }
            to { transform: rotateY(360deg); }
        }
    </style>
</head>
<body>

    <div id="bg-layer"></div>
    <canvas id="canvas-overlay"></canvas>
    <div id="overlay"></div>

    <div id="content-wrapper">
        <button id="enter-btn" onclick="initializeSystem()">KATTINTS RÁM</button>
        <h1 id="main-title"></h1>
        <div id="sub-title"></div>

        <div id="video-wrapper"><div id="player"></div></div>
        <div id="gallery-wrapper">
            <div class="gallery-container" id="gallery">
                <button class="nav-btn prev" onclick="changeSlide(-1)">❮</button>
                <button class="nav-btn next" onclick="changeSlide(1)">❯</button>
            </div>
            <div id="bg-audio-player" style="display:none;"></div>
        </div>
    </div>

    <img id="decoration" src="" alt="Dekoráció" style="display:none;">

    <script>
        /* --- PARAMÉTEREK --- */
        const urlParams = new URLSearchParams(window.location.search);
        const pCim    = urlParams.get('cim');
        const pAlcim  = urlParams.get('alcim');
        const pZene   = urlParams.get('zene');
        const pMode   = urlParams.get('mode')   || "zene";
        const pBg     = urlParams.get('bg')     || "000000";
        const pGomb   = urlParams.get('gomb')   || "KATTINTS RÁM";
        const pBgMove = urlParams.get('bgmove') || "0";
        const pEffect = urlParams.get('effect'); // snow, heart, matrix
        const pIntens = parseInt(urlParams.get('intensity')) || 5;
        const pSize   = parseInt(urlParams.get('psize')) || 0; // Szemcseméret
        const pDeco   = urlParams.get('deco'); // advent, halloween, vagy kép linkje
        const pKepek  = urlParams.get('kepek')  ? urlParams.get('kepek').split(',') : [];

        const canvas = document.getElementById('canvas-overlay');
        const ctx = canvas.getContext('2d');
        let particles = [];

        /* --- EFFEKT MOTOR --- */
        function initParticles() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            particles = [];
            let count = pIntens * 20;
            if (pEffect === 'matrix') count = pIntens * 5;

            for (let i = 0; i < count; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: (Math.random() * (pEffect === 'snow' ? 4 : 20) + 2) + pSize, // pSize hozzáadása
                    speed: Math.random() * 3 + 1,
                    opacity: Math.random(),
                    char: pEffect === 'matrix' ? String.fromCharCode(0x30A0 + Math.random() * 96) : (pEffect === 'heart' ? '❤' : '●')
                });
            }
        }

        function drawParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => {
                ctx.fillStyle = pEffect === 'matrix' ? `rgba(0, 255, 0, ${p.opacity})` : (pEffect === 'heart' ? `rgba(255, 0, 0, ${p.opacity})` : `rgba(255, 255, 255, ${p.opacity})`);
                ctx.font = `${p.size}px Arial`;
                ctx.fillText(p.char, p.x, p.y);
                
                p.y += p.speed;
                if (pEffect === 'matrix') p.char = String.fromCharCode(0x30A0 + Math.random() * 96);
                if (p.y > canvas.height) { p.y = -20; p.x = Math.random() * canvas.width; }
            });
            requestAnimationFrame(drawParticles);
        }

        /* --- INICIALIZÁLÁS --- */
        if (pCim || pAlcim || pZene || pDeco) { // Deco paraméter megléte is indítja
            document.getElementById('content-wrapper').style.display = 'flex';
            document.getElementById('enter-btn').innerText = pGomb;
            const bgLayer = document.getElementById('bg-layer');
            if (pBg.startsWith('http')) bgLayer.style.backgroundImage = "url('" + pBg + "')";
            else bgLayer.style.backgroundColor = "#" + pBg;

            if (pBgMove === "1") {
                window.addEventListener('mousemove', (e) => {
                    const x = (window.innerWidth / 2 - e.pageX) / 15;
                    const y = (window.innerHeight / 2 - e.pageY) / 15;
                    bgLayer.style.transform = `translate(${x}px, ${y}px)`;
                });
            }
            if (pEffect) { initParticles(); drawParticles(); }

            // DEKORÁCIÓ BEÁLLÍTÁSA
            const decorationImg = document.getElementById('decoration');
            if (pDeco) {
                decorationImg.style.display = 'block';
                let imageUrl = '';
                if (pDeco === 'advent') {
                    //imageUrl = 'https://i.imgur.com/your_advent_wreath_image.png'; // CSERÉLD KI EGY VALÓDI KÉPLINKRE
                    imageUrl = '';
                    
                    decorationImg.style.maxWidth = '200px'; // Kisebb adventi koszorú
                    decorationImg.style.bottom = '10px';
                    decorationImg.style.left = '10px'; // Bal alsó sarokba
                    decorationImg.style.right = 'auto'; // Ne legyen jobb pozíció
                } else if (pDeco === 'halloween') {
                    //imageUrl = 'https://i.imgur.com/your_halloween_pumpkin_image.png'; // CSERÉLD KI EGY VALÓDI KÉPLINKRE
                    imageUrl = 'https://www.google.com/url?sa=t&source=web&rct=j&url=https%3A%2F%2Fwww.freepik.com%2Fpremium-psd%2Fpsd-3d-witch-pumpkin-icon-halloween-png-download_47007913.htm&ved=0CBYQjRxqFwoTCMi1-tP0uZIDFQAAAAAdAAAAABAI&opi=89978449';
                    decorationImg.classList.add('decoration-rotate'); // Forgó tök
                } else if (pDeco.startsWith('http')) {
                    imageUrl = pDeco; // Egyedi kép linkje
                }
                if (imageUrl) decorationImg.src = imageUrl;
            }
            
            var tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            document.head.appendChild(tag);
        }

        var player;
        function onYouTubeIframeAPIReady() {
            if(!pZene) return;
            player = new YT.Player((pMode === 'video' ? 'player' : 'bg-audio-player'), {
                height: (pMode === 'video' ? '280' : '0'), width: '100%', videoId: pZene,
                playerVars: { 'autoplay': 0, 'controls': (pMode === 'video' ? 1 : 0), 'rel':0, 'mute':1 }
            });
        }

        async function initializeSystem() {
            if (pBgMove === "1") {
                if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                    try {
                        const permission = await DeviceOrientationEvent.requestPermission();
                        if (permission === 'granted') window.addEventListener('deviceorientation', (e) => {
                            const bg = document.getElementById('bg-layer');
                            bg.style.transform = `translate(${e.gamma * 2}px, ${(e.beta - 45) * 2}px)`;
                        });
                    } catch (e) { console.error(e); }
                } else {
                    window.addEventListener('deviceorientation', (e) => {
                        const bg = document.getElementById('bg-layer');
                        bg.style.transform = `translate(${e.gamma * 2}px, ${(e.beta - 45) * 2}px)`;
                    });
                }
            }
            document.getElementById('enter-btn').style.display = 'none';
            typeWriter(pCim || "", "main-title", 60, () => { if(pAlcim) typeWriter(pAlcim, "sub-title", 40); });
            if (pMode === 'video') document.getElementById('video-wrapper').style.display = 'block';
            if (pMode === 'kep') { document.getElementById('gallery-wrapper').style.display = 'block'; setupGallery(); }
            if(player && player.playVideo) { player.unMute(); player.setVolume(100); player.playVideo(); }
        }

        function typeWriter(text, elementId, speed, callback) {
            let i = 0; const el = document.getElementById(elementId);
            function type() { if (i < text.length) { el.innerHTML += text.charAt(i); i++; setTimeout(type, speed); } else if (callback) callback(); }
            type();
        }

        let slideIndex = 1;
        function setupGallery() {
            const container = document.getElementById('gallery');
            pKepek.forEach((url) => {
                let img = document.createElement('img'); img.src = url; img.className = 'slide';
                container.insertBefore(img, container.firstChild);
            });
            showSlides(slideIndex);
        }
        function showSlides(n) {
            let s = document.getElementsByClassName("slide"); if (!s.length) return;
            if (n > s.length) slideIndex = 1; if (n < 1) slideIndex = s.length;
            for (let i = 0; i < s.length; i++) s[i].style.display = "none";
            s[slideIndex-1].style.display = "block";
        }
        function changeSlide(n) { showSlides(slideIndex += n); }
        window.onresize = () => { if(pEffect) initParticles(); };
    </script>
</body>
</html>
